<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificateur Retraite</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 Planificateur Retraite</h1>
            <p>Optimisez votre stratégie de retraite en quelques clics</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('client-info')">👥 Informations Client</button>
            <button class="tab" onclick="switchTab('finances')">💰 Situation Financière</button>
            <button class="tab" onclick="switchTab('simulation')">💸 Gestion des Sorties</button>
            <button class="tab" onclick="switchTab('projection')">📊 Projection & Stratégie</button>
        </div>

        <!-- Onglet 1: Informations Client -->
        <div id="client-info" class="tab-content active">
            <div class="couple-toggle">
                <span>Personne seule</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="coupleToggle" onchange="toggleCouple()">
                    <span class="slider"></span>
                </label>
                <span>Couple</span>
            </div>

            <div class="client-sections" id="clientSections">
                <div class="client-section">
                    <h4>👤 Client Principal</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nom1">Nom</label>
                            <input type="text" id="nom1" placeholder="Nom de famille">
                        </div>
                        <div class="form-group">
                            <label for="prenom1">Prénom</label>
                            <input type="text" id="prenom1" placeholder="Prénom">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="age1">Âge actuel</label>
                            <input type="number" id="age1" min="18" max="100" placeholder="35">
                        </div>
                        <div class="form-group">
                            <label for="dateRetraite1">Date de départ à la retraite</label>
                            <input type="date" id="dateRetraite1" onchange="calculateTimeToRetirement(1)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="revenus1">Revenus nets actuels (€/mois)</label>
                            <input type="number" id="revenus1" placeholder="3500" class="euro">
                        </div>
                        <div class="form-group">
                            <label for="revenusRetraite1">Revenus nets prévus à la retraite (€/mois)</label>
                            <input type="number" id="revenusRetraite1" placeholder="2100" class="euro">
                        </div>
                    </div>
                    <div id="tempsRestant1" class="warning-box" style="display: none;">
                        <strong>⏰ Temps restant avant la retraite : </strong><span id="dureeRetraite1"></span>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>🧾 Parts Fiscales</h3>
                <div class="parts-fiscales-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="partsEntieres">Parts entières</label>
                            <select id="partsEntieres" onchange="updateTotalParts()">
                                <option value="1">1 part (célibataire)</option>
                                <option value="2" selected>2 parts (couple)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="demiParts">Demi-parts supplémentaires</label>
                            <select id="demiParts" onchange="updateTotalParts()">
                                <option value="0">0 demi-part</option>
                                <option value="0.5">0.5 (1 enfant ou invalide)</option>
                                <option value="1">1 (2 enfants)</option>
                                <option value="1.5">1.5 (3 enfants)</option>
                                <option value="2">2 (4 enfants)</option>
                                <option value="2.5">2.5 (5 enfants)</option>
                                <option value="3">3 (6 enfants)</option>
                            </select>
                        </div>
                    </div>
                    <div class="parts-total-display">
                        <strong>Total parts fiscales : <span id="totalPartsDisplay">2</span></strong>
                        <input type="hidden" id="parts" value="2">
                    </div>
                </div>
            </div>
        </div>

        <!-- Onglet 2: Revenus et Situation Financière -->
        <div id="finances" class="tab-content">
            
            <!-- SECTION 1: REVENUS DÉTAILLÉS -->
            <div class="form-section">
                <h3>💰 Revenus Détaillés</h3>
                
                <!-- Toggle mode simple/détaillé -->
                <div class="mode-toggle">
                    <label class="toggle-switch">
                        <input type="checkbox" id="modeDetaille" onchange="toggleModeDetaille()">
                        <span class="slider"></span>
                    </label>
                    <span>Mode détaillé (calcul fiscal précis)</span>
                </div>
                
                <!-- Mode simple (valeurs de l'onglet 1) -->
                <div id="modeSimple" class="mode-section">
                    <div class="recap-revenus">
                        <h4>📊 Récapitulatif (depuis onglet 1)</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Revenus nets actuels</label>
                                <input type="text" id="revenusNetsRecap" readonly class="recap-field">
                            </div>
                            <div class="form-group">
                                <label>Revenus nets retraite</label>
                                <input type="text" id="revenusRetraiteRecap" readonly class="recap-field">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mode détaillé -->
                <div id="modeDetailleSection" class="mode-section" style="display: none;">
                    
                    <!-- CLIENT PRINCIPAL -->
                    <div class="revenus-person-detail">
                        <h4>👤 Client Principal - Revenus Détaillés</h4>
                        
                        <!-- Revenus salariaux actuels -->
                        <div class="revenus-category">
                            <h5>🏢 Revenus Salariaux Actuels</h5>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Statut professionnel</label>
                                    <select id="statutPro1" onchange="updateStatutPro(1)">
                                        <option value="salarie">Salarié du privé</option>
                                        <option value="fonctionnaire">Fonctionnaire</option>
                                        <option value="retraite">Déjà retraité</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Salaire brut annuel (€)</label>
                                    <input type="number" id="salaireBrut1" placeholder="45000" onchange="calculateSalaryDetails(1)">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Déduction fiscale</label>
                                    <select id="deductionType1" onchange="updateDeductionType(1)">
                                        <option value="abattement">Abattement 10% (standard)</option>
                                        <option value="frais-reels">Frais réels</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Zone frais réels -->
                            <div id="fraisReels1" class="frais-reels-zone" style="display: none;">
                                <h6>📝 Détail Frais Réels</h6>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Frais transport (€/an)</label>
                                        <input type="number" placeholder="2400" onchange="calculateSalaryDetails(1)">
                                    </div>
                                    <div class="form-group">
                                        <label>Frais repas (€/an)</label>
                                        <input type="number" placeholder="1800" onchange="calculateSalaryDetails(1)">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Autres frais professionnels (€/an)</label>
                                    <input type="number" placeholder="500" onchange="calculateSalaryDetails(1)">
                                </div>
                            </div>
                            
                            <div class="calcul-result">
                                <strong>Revenu net fiscal : <span id="revenuNetFiscal1">0 €</span></strong>
                            </div>
                        </div>
                        
                        <!-- Pensions retraite -->
                        <div class="revenus-category">
                            <h5>🏖️ Pensions de Retraite Prévues</h5>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Pension brute annuelle (€)</label>
                                    <input type="number" id="pensionBrute1" placeholder="25000" onchange="calculatePensionDetails(1)">
                                </div>
                                <div class="form-group">
                                    <label>Abattement pension</label>
                                    <select id="abattementPension1" onchange="calculatePensionDetails(1)">
                                        <option value="10">10% (standard)</option>
                                        <option value="0">Aucun abattement</option>
                                    </select>
                                </div>
                            </div>
                            <div class="calcul-result">
                                <strong>Pension nette fiscale : <span id="pensionNetFiscale1">0 €</span></strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CONJOINT -->
                    <div id="conjoint-revenus-detail" class="revenus-person-detail" style="display: none;">
                        <h4>👫 Conjoint - Revenus Détaillés</h4>
                        
                        <!-- Revenus salariaux actuels conjoint -->
                        <div class="revenus-category">
                            <h5>🏢 Revenus Salariaux Actuels</h5>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Statut professionnel</label>
                                    <select id="statutPro2" onchange="updateStatutPro(2)">
                                        <option value="salarie">Salarié du privé</option>
                                        <option value="fonctionnaire">Fonctionnaire</option>
                                        <option value="retraite">Déjà retraité</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Salaire brut annuel (€)</label>
                                    <input type="number" id="salaireBrut2" placeholder="35000" onchange="calculateSalaryDetails(2)">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Déduction fiscale</label>
                                    <select id="deductionType2" onchange="updateDeductionType(2)">
                                        <option value="abattement">Abattement 10% (standard)</option>
                                        <option value="frais-reels">Frais réels</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Zone frais réels conjoint -->
                            <div id="fraisReels2" class="frais-reels-zone" style="display: none;">
                                <h6>📝 Détail Frais Réels</h6>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Frais transport (€/an)</label>
                                        <input type="number" placeholder="1800" onchange="calculateSalaryDetails(2)">
                                    </div>
                                    <div class="form-group">
                                        <label>Frais repas (€/an)</label>
                                        <input type="number" placeholder="1200" onchange="calculateSalaryDetails(2)">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Autres frais professionnels (€/an)</label>
                                    <input type="number" placeholder="300" onchange="calculateSalaryDetails(2)">
                                </div>
                            </div>
                            
                            <div class="calcul-result">
                                <strong>Revenu net fiscal : <span id="revenuNetFiscal2">0 €</span></strong>
                            </div>
                        </div>
                        
                        <!-- Pensions retraite conjoint -->
                        <div class="revenus-category">
                            <h5>🏖️ Pensions de Retraite Prévues</h5>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Pension brute annuelle (€)</label>
                                    <input type="number" id="pensionBrute2" placeholder="18000" onchange="calculatePensionDetails(2)">
                                </div>
                                <div class="form-group">
                                    <label>Abattement pension</label>
                                    <select id="abattementPension2" onchange="calculatePensionDetails(2)">
                                        <option value="10">10% (standard)</option>
                                        <option value="0">Aucun abattement</option>
                                    </select>
                                </div>
                            </div>
                            <div class="calcul-result">
                                <strong>Pension nette fiscale : <span id="pensionNetFiscale2">0 €</span></strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- REVENUS PROFESSIONNELS NON-SALARIÉS -->
                    <div class="revenus-category">
                        <h5>💼 Revenus Professionnels Non-Salariés</h5>
                        <div class="toggle-section">
                            <label>
                                <input type="checkbox" id="hasRevenusPro" onchange="toggleRevenusPro()">
                                J'ai des revenus BNC, BIC ou BA
                            </label>
                        </div>
                        <div id="revenusProDetail" style="display: none;">
                            <!-- Section BNC/BIC détaillée - sera remplie par JavaScript -->
                        </div>
                    </div>
                    
                    <!-- REVENUS FONCIERS -->
                    <div class="revenus-category">
                        <h5>🏠 Revenus Fonciers</h5>
                        <div class="toggle-section">
                            <label>
                                <input type="checkbox" id="hasRevenusFoncier" onchange="toggleRevenusFoncier()">
                                J'ai des revenus fonciers
                            </label>
                        </div>
                        <div id="revenusFoncierDetail" style="display: none;">
                            <!-- Section foncier détaillée - sera remplie par JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SECTION 2: AUTRES REVENUS ET LIQUIDITÉS -->
            <div class="form-section">
                <h3>💳 Autres Revenus et Liquidités</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="revenusAutres">Autres revenus (€/mois)</label>
                        <input type="number" id="revenusAutres" placeholder="800" class="euro">
                        <small style="color: #6c757d;">Capitaux mobiliers, rentes, etc.</small>
                    </div>
                    <div class="form-group">
                        <label for="liquidites">Liquidités disponibles (€)</label>
                        <input type="number" id="liquidites" placeholder="25000" class="euro">
                        <small style="color: #6c757d;">Épargne disponible immédiatement</small>
                    </div>
                </div>
            </div>
            
            <!-- SECTION 3: CHARGES MENSUELLES -->
            <div class="form-section">
                <h3>📊 Charges Mensuelles</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="trainVie">Train de vie (€/mois)</label>
                        <input type="number" id="trainVie" placeholder="2800" class="euro">
                        <small style="color: #6c757d;">Alimentation, loisirs, vêtements, assurances...</small>
                    </div>
                    <div class="form-group">
                        <label for="impotInfo">Impôts (calculés automatiquement)</label>
                        <input type="text" value="Calcul automatique basé sur vos revenus" readonly style="background: #f8f9fa; font-style: italic;">
                    </div>
                </div>
                
                <div id="credits-section">
                    <h4>🏠 Crédits en cours</h4>
                    <div id="creditsList">
                        <div class="contract-item credit-item">
                            <div class="form-group">
                                <label>Type de crédit</label>
                                <select>
                                    <option>Immobilier</option>
                                    <option>Consommation</option>
                                    <option>Auto</option>
                                    <option>Autre</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Mensualité (€)</label>
                                <input type="number" placeholder="1200" class="euro mensualite-credit" onchange="updateCreditCalculations()">
                            </div>
                            <div class="form-group">
                                <label>Capital restant dû (€)</label>
                                <input type="number" placeholder="150000" class="euro capital-restant" onchange="updateCreditCalculations()">
                            </div>
                            <div class="form-group">
                                <label>Date de fin</label>
                                <input type="date" class="date-fin-credit">
                            </div>
                            <div class="form-group remboursement-anticipe-group">
                                <label style="font-weight: bold; color: #e91e63;">Rembourser par anticipation ?</label>
                                <select class="remboursement-anticipe" onchange="toggleRemboursementAnticipe(this)">
                                    <option value="non">❌ Non</option>
                                    <option value="oui">✅ Oui</option>
                                </select>
                            </div>
                            <div class="remboursement-details" style="display: none; background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 10px;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>IRA estimées (€)</label>
                                        <input type="number" class="ira-estimees" placeholder="3000" readonly style="background: #f8f9fa;">
                                    </div>
                                    <div class="form-group">
                                        <label>Coût total (€)</label>
                                        <input type="number" class="cout-total-remboursement" readonly style="background: #f8f9fa; font-weight: bold;">
                                    </div>
                                </div>
                                <div class="economie-mensuelle" style="background: #e8f5e8; padding: 10px; border-radius: 6px; text-align: center; margin-top: 10px;">
                                    <span style="color: #28a745; font-weight: bold;">💰 Économie mensuelle : <span class="montant-economie">0 €</span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="add-contract-btn" onclick="addCredit()">➕ Ajouter un crédit</button>
                </div>

                <button class="calculate-btn" onclick="calculateBudgetWithDetails()">🧮 Calculer le déficit retraite</button>
                <div id="budgetResult" class="result-box">
                    <h4>💡 Analyse Budgétaire</h4>
                    <p id="deficitText"></p>
                </div>
            </div>
        </div>

        <!-- Onglet 3: Gestion des Sorties -->
        <div id="simulation" class="tab-content">
            <div class="form-section">
                <h3>💼 Gestion des Contrats et Sorties</h3>
                <p style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <strong>💡 Objectif :</strong> Calculez les frais de sortie de vos contrats pour combler le déficit identifié dans l'onglet précédent.
                </p>
                
                <div id="deficitRecap" style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 25px; display: none;">
                    <h5 style="color: #856404; margin-bottom: 10px;">🎯 Rappel du Déficit à Combler</h5>
                    <p id="deficitAmount" style="margin: 0; font-size: 1.1em;"></p>
                </div>
                
                <div class="contracts-management">
                    <h4 style="color: #2c3e50; margin-bottom: 20px;">📋 Contrats Financiers Détaillés</h4>
                    <div id="contractsManagementList">
                        <div class="contract-management-item">
                            <div class="contract-header">
                                <div class="form-group">
                                    <label>Nom du contrat</label>
                                    <input type="text" placeholder="Ex: AV Crédit Agricole - Predica" style="font-weight: 600;">
                                </div>
                                <div class="form-group">
                                    <label>Type</label>
                                    <select onchange="updateContractType(this)">
                                        <option>Assurance Vie</option>
                                        <option>PER</option>
                                        <option>Capitalisation</option>
                                        <option>FCPI</option>
                                        <option>SCPI</option>
                                        <option>Actions</option>
                                        <option>Autre</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Montant (€)</label>
                                    <input type="number" placeholder="85000" class="euro" onchange="updateContractCalculations(this)">
                                </div>
                                <div class="form-group">
                                    <label>Date d'ouverture</label>
                                    <input type="date" class="date-ouverture" onchange="updateContractCalculations(this)">
                                </div>
                            </div>
                            
                            <div class="contract-details">
                                <h6 style="color: #495057; margin-bottom: 15px;">🧾 Fiscalité et Sortie</h6>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                                    <div class="form-group">
                                        <label>IR sur plus-values (%)</label>
                                        <input type="number" step="0.1" placeholder="12.8" class="percentage taux-ir" onchange="updateContractCalculations(this)">
                                    </div>
                                    <div class="form-group">
                                        <label>Prélèvements Sociaux (%)</label>
                                        <input type="number" step="0.1" placeholder="17.2" class="percentage taux-ps" onchange="updateContractCalculations(this)">
                                    </div>
                                    <div class="form-group">
                                        <label>Exonération IR</label>
                                        <select class="exoneration-ir" onchange="toggleIRExemption(this)">
                                            <option value="non">Non</option>
                                            <option value="oui">Oui (>8 ans, etc.)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Exonération PS</label>
                                        <select class="exoneration-ps" onchange="updateContractCalculations(this)">
                                            <option value="non">Non</option>
                                            <option value="oui">Oui</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                                    <div class="form-group">
                                        <label>Plus-value estimée (€)</label>
                                        <input type="number" placeholder="15000" class="euro plus-value" onchange="updateContractCalculations(this)">
                                    </div>
                                    <div class="form-group">
                                        <label>Type de sortie</label>
                                        <select class="type-sortie" onchange="updateContractCalculations(this)">
                                            <option>Capital</option>
                                            <option>Rente</option>
                                            <option>Mixte</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label style="font-weight: bold; color: #d63384;">Sortir ce contrat ?</label>
                                        <select onchange="toggleContractExit(this)" style="border: 2px solid #d63384;">
                                            <option value="non">❌ Non</option>
                                            <option value="oui">✅ Oui</option>
                                        </select>
                                    </div>
                                    <div class="contract-fees" style="background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center;">
                                        <small style="color: #6c757d;">Frais de sortie</small><br>
                                        <strong class="fees-amount" style="color: #dc3545;">0 €</strong>
                                    </div>
                                </div>

                                <!-- Section spéciale pour les rentes -->
                                <div class="rente-details" style="display: none; background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                                    <h6 style="color: #1565c0; margin-bottom: 10px;">📈 Détails de la Rente Viagère</h6>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Âge à la liquidation</label>
                                            <input type="number" class="age-liquidation" placeholder="65" min="50" max="85" onchange="updateContractCalculations(this)">
                                        </div>
                                        <div class="form-group">
                                            <label>Fraction imposable</label>
                                            <input type="text" class="fraction-imposable" readonly style="background: #f8f9fa;">
                                        </div>
                                        <div class="form-group">
                                            <label>Rente brute mensuelle estimée (€)</label>
                                            <input type="number" class="rente-mensuelle" placeholder="400" onchange="updateContractCalculations(this)">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="add-contract-btn" onclick="addManagementContract()">➕ Ajouter un contrat</button>
                </div>
                
                <div style="margin-top: 30px;">
                    <button class="calculate-btn" onclick="calculateExitFees()">💰 Calculer les frais totaux de sortie</button>
                    
                    <div id="exitFeesResult" class="result-box">
                        <h4>💸 Estimation des Frais de Sortie</h4>
                        <div id="feesBreakdown"></div>
                        <div id="netAmountAvailable"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onglet 4: Projection & Stratégie -->
        <div id="projection" class="tab-content">
            <div class="form-section">
                <h3>🎯 Stratégie de Comblement du Déficit</h3>
                <p style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <strong>💡 Objectif :</strong> Analyser votre stratégie retraite en utilisant les rentes viagères pour sécuriser vos revenus 
                    et en optimisant le placement des capitaux récupérés. Cette projection vous montre l'évolution de votre patrimoine 
                    et la durabilité de votre stratégie.
                </p>
                
                <!-- Récapitulatif des données précédentes -->
                <div id="dataRecap" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #ffebee; padding: 20px; border-radius: 10px; border-left: 5px solid #f44336;">
                        <h5 style="color: #c62828; margin-bottom: 10px;">🎯 Déficit Initial</h5>
                        <div id="deficitProjection" style="font-size: 1.3em; font-weight: bold; color: #d32f2f;">
                            Calculez d'abord votre déficit dans l'onglet "Situation Financière"
                        </div>
                    </div>
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; border-left: 5px solid #2196f3;">
                        <h5 style="color: #1565c0; margin-bottom: 10px;">📈 Revenus de Rentes</h5>
                        <div id="rentesProjection" style="font-size: 1.3em; font-weight: bold; color: #1976d2;">
                            0 € / mois
                        </div>
                    </div>
                    <div style="background: #e1f5fe; padding: 20px; border-radius: 10px; border-left: 5px solid #03a9f4;">
                        <h5 style="color: #0277bd; margin-bottom: 10px;">🏦 Économies Crédits</h5>
                        <div id="economiesCredits" style="font-size: 1.3em; font-weight: bold; color: #0288d1;">
                            0 € / mois
                        </div>
                    </div>
                    <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; border-left: 5px solid #4caf50;">
                        <h5 style="color: #2e7d32; margin-bottom: 10px;">💰 Capital Disponible</h5>
                        <div id="capitalProjection" style="font-size: 1.3em; font-weight: bold; color: #388e3c;">
                            Simulez vos sorties dans l'onglet "Gestion des Sorties"
                        </div>
                    </div>
                </div>

                <!-- Section Allocation Intelligente des Contrats -->
                <div id="allocationOverview" style="display: none; margin-bottom: 30px;">
                    <h4 style="color: #2c3e50; margin-bottom: 20px; text-align: center; font-size: 1.4em;">
                        🎯 Allocation Intelligente des Contrats
                    </h4>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                        <p style="margin: 0; color: #495057; font-style: italic;">
                            <strong>Stratégie hybride :</strong> Sécurisation par les rentes viagères + Optimisation du capital restant
                        </p>
                    </div>
                    <div id="allocationGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px;"></div>
                </div>

                <!-- Configuration de la stratégie -->
                <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-bottom: 25px;">
                    <h4 style="color: #2c3e50; margin-bottom: 20px;">⚙️ Paramètres de Projection</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div class="form-group">
                            <label for="rendementReplacement">Rendement nouveaux placements (%/an)</label>
                            <input type="number" id="rendementReplacement" step="0.1" value="3.5" placeholder="3.5">
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                Rendement des capitaux récupérés et replacés (fonds euros, SCPI, etc.)
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="inflationRate">Taux d'inflation (%/an)</label>
                            <input type="number" id="inflationRate" step="0.1" value="2.0" placeholder="2.0">
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                Impact sur l'évolution des besoins et des revenus
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="ageEsperanceVie">Espérance de vie (années)</label>
                            <input type="number" id="ageEsperanceVie" value="85" placeholder="85">
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                Pour calculer la durée de projection
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="anneesObjectifCouverture">Objectif couverture (années)</label>
                            <input type="number" id="anneesObjectifCouverture" value="20" placeholder="20">
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                Années de déficit à couvrir par le capital
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Bouton de calcul principal -->
                <div style="text-align: center; margin-bottom: 30px;">
                    <button class="calculate-btn" onclick="calculateProjection()" style="font-size: 1.2em; padding: 20px 40px;">
                        🚀 Calculer la Projection Complète
                    </button>
                </div>
                
                <!-- Résultats de la projection -->
                <div id="projectionResult" class="result-box">
                    <h4 style="text-align: center; color: #2c3e50; margin-bottom: 25px; font-size: 1.3em;">
                        📊 Projection de Comblement du Déficit
                    </h4>
                    
                    <!-- Résumé de la stratégie -->
                    <div id="strategyOverview" style="margin-bottom: 25px;"></div>
                    
                    <!-- Tableau de projection -->
                    <div id="projectionTable" style="margin-bottom: 25px;"></div>
                    
                    <!-- Graphique (futur) -->
                    <div id="projectionChart" style="display: none; margin-bottom: 25px;">
                        <h5 style="color: #2c3e50; margin-bottom: 15px;">📈 Évolution Graphique</h5>
                        <canvas id="projectionCanvas" width="800" height="400"></canvas>
                    </div>
                    
                    <!-- Scénarios alternatifs -->
                    <div id="alternativeScenarios" style="display: none; margin-bottom: 25px;">
                        <h5 style="color: #2c3e50; margin-bottom: 15px;">🔄 Scénarios Alternatifs</h5>
                        <div id="scenariosContent"></div>
                    </div>
                    
                    <!-- Recommandations -->
                    <div id="recommendations" style="margin-bottom: 25px;"></div>
                    
                    <!-- Actions concrètes -->
                    <div id="actionPlan" style="margin-bottom: 25px;">
                        <h5 style="color: #2c3e50; margin-bottom: 15px;">✅ Plan d'Action Recommandé</h5>
                        <div id="actionPlanContent"></div>
                    </div>
                </div>

                <!-- Section d'aide contextuelle -->
                <div style="background: #e8f4fd; padding: 20px; border-radius: 10px; border-left: 5px solid #2196f3; margin-top: 30px;">
                    <h5 style="color: #1565c0; margin-bottom: 15px;">💡 Aide à l'Interprétation</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div>
                            <h6 style="color: #1976d2; margin-bottom: 8px;">📈 Rentes Viagères</h6>
                            <p style="margin: 0; font-size: 0.9em; line-height: 1.4;">
                                Revenus garantis à vie, indexés ou non selon le contrat. 
                                Priorité absolue car sécurisent définitivement une partie du déficit.
                            </p>
                        </div>
                        <div>
                            <h6 style="color: #1976d2; margin-bottom: 8px;">💰 Capital Réinvesti</h6>
                            <p style="margin: 0; font-size: 0.9em; line-height: 1.4;">
                                Capital replacé sur nouveaux supports pour générer des revenus complémentaires 
                                tout en préservant le patrimoine.
                            </p>
                        </div>
                        <div>
                            <h6 style="color: #1976d2; margin-bottom: 8px;">🎯 Capital Consommé</h6>
                            <p style="margin: 0; font-size: 0.9em; line-height: 1.4;">
                                Capital prélevé progressivement pour combler le déficit résiduel. 
                                Durée limitée mais complète la stratégie.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <script src="main.js"></script>
</body>
</html>
